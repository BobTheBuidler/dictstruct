

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dictstruct._lazy &mdash; dictstruct  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dictstruct
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dictstruct</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">dictstruct._lazy</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dictstruct._lazy</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">msgspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">UNSET</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dictstruct._main</span><span class="w"> </span><span class="kn">import</span> <span class="n">DictStruct</span>


<div class="viewcode-block" id="LazyDictStruct">
<a class="viewcode-back" href="../../index.html#dictstruct.LazyDictStruct">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LazyDictStruct</span><span class="p">(</span><span class="n">DictStruct</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>  <span class="c1"># type: ignore [call-arg]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of :class:`DictStruct` that supports Just-In-Time (JIT) decoding of field values.</span>

<span class="sd">    `LazyDictStruct` is designed for developers who need to efficiently handle large or complex data structures, particularly when working with serialized data formats like JSON. By storing field values in a raw, undecoded format, this class allows for deferred decoding, meaning that data is only decoded when accessed. This approach can lead to significant performance improvements and reduced memory usage, especially in scenarios where not all fields are always needed.</span>

<span class="sd">    Key Features:</span>
<span class="sd">    - **JIT Decoding**: Decode data only when accessed, saving processing time and memory.</span>
<span class="sd">    - **Immutable Structure**: As a frozen dataclass, instances are immutable, ensuring data integrity after creation.</span>
<span class="sd">    - **Compatibility**: Inherits from :class:`DictStruct`, making it compatible with the standard dictionary API, allowing for easy integration with existing codebases that rely on dictionary-like data structures.</span>

<span class="sd">    Use Cases:</span>
<span class="sd">    - Handling large JSON responses from APIs where only a subset of the data is needed at any given time.</span>
<span class="sd">    - Optimizing applications that process data lazily, improving startup times and reducing resource consumption.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import msgspec</span>
<span class="sd">        &gt;&gt;&gt; from functools import cached_property</span>
<span class="sd">        &gt;&gt;&gt; class MyStruct(LazyDictStruct):</span>
<span class="sd">        ...     _myField: msgspec.Raw = msgspec.field(name=&#39;myField&#39;)</span>
<span class="sd">        ...     @cached_property</span>
<span class="sd">        ...     def myField(self) -&gt; YourGiantJsonObject:</span>
<span class="sd">        ...         &#39;&#39;&#39;Decode the raw JSON data into a python object when accessed.&#39;&#39;&#39;</span>
<span class="sd">        ...         return msgspec.json.decode(self._myField, type=YourGiantJsonObject)</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; # Encode data into a raw JSON format</span>
<span class="sd">        &gt;&gt;&gt; raw_data = msgspec.json.encode({&quot;myField&quot;: &quot;some value&quot;})</span>
<span class="sd">        &gt;&gt;&gt; # Create an instance of MyStruct with the raw data</span>
<span class="sd">        &gt;&gt;&gt; my_struct = MyStruct(_myField=raw_data)</span>
<span class="sd">        &gt;&gt;&gt; # Access the decoded field value</span>
<span class="sd">        &gt;&gt;&gt; print(my_struct.myField)</span>
<span class="sd">        &quot;some value&quot;</span>

<span class="sd">    See Also:</span>
<span class="sd">        :class:`DictStruct` for the base class implementation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LazyDictStruct.__init_subclass__">
<a class="viewcode-back" href="../../index.html#dictstruct.LazyDictStruct.__init_subclass__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a subclass of :class:`LazyDictStruct`.</span>

<span class="sd">        This method resolves any lazy field names (prefixed with an underscore) and overwrites</span>
<span class="sd">        `cls.__struct_fields__` so it contains the names of the materialized properties</span>
<span class="sd">        defined on your subclass.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Positional arguments.</span>
<span class="sd">            **kwargs: Keyword arguments.</span>

<span class="sd">        See Also:</span>
<span class="sd">            :class:`DictStruct` for the base class implementation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;StructMeta&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">struct_fields</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__struct_fields__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># TODO: debug this</span>
            <span class="k">return</span>

        <span class="n">resolved_fields</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">field</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="k">else</span> <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">struct_fields</span>
        <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">__struct_fields__</span> <span class="o">=</span> <span class="n">resolved_fields</span></div>


<div class="viewcode-block" id="LazyDictStruct.__contains__">
<a class="viewcode-back" href="../../index.html#dictstruct.LazyDictStruct.__contains__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a key is in the struct.</span>

<span class="sd">        Args:</span>
<span class="sd">            key: The key to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the key is present and not :obj:`~msgspec.UNSET`, False otherwise.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; class MyStruct(LazyDictStruct):</span>
<span class="sd">            ...     field1: str</span>
<span class="sd">            &gt;&gt;&gt; s = MyStruct(field1=&quot;value&quot;)</span>
<span class="sd">            &gt;&gt;&gt; &#39;field1&#39; in s</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; &#39;field2&#39; in s</span>
<span class="sd">            False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__struct_fields__</span>
        <span class="n">in_fields</span> <span class="o">=</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">fields</span>
        <span class="k">return</span> <span class="n">in_fields</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">UNSET</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span></div>


<div class="viewcode-block" id="LazyDictStruct.__iter__">
<a class="viewcode-back" href="../../index.html#dictstruct.LazyDictStruct.__iter__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through the keys of the Struct.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Struct key.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; class MyStruct(LazyDictStruct):</span>
<span class="sd">            ...     field1: str</span>
<span class="sd">            ...     field2: int</span>
<span class="sd">            &gt;&gt;&gt; s = MyStruct(field1=&quot;value&quot;, field2=42)</span>
<span class="sd">            &gt;&gt;&gt; list(iter(s))</span>
<span class="sd">            [&#39;field1&#39;, &#39;field2&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__struct_fields__</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">UNSET</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">field</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="k">else</span> <span class="n">field</span></div>


<div class="viewcode-block" id="LazyDictStruct.items">
<a class="viewcode-back" href="../../index.html#dictstruct.LazyDictStruct.items">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over the struct&#39;s field name and value pairs.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; class MyStruct(DictStruct):</span>
<span class="sd">            ...     field1: str</span>
<span class="sd">            ...     field2: int</span>
<span class="sd">            &gt;&gt;&gt; s = MyStruct(field1=&quot;value&quot;, field2=42)</span>
<span class="sd">            &gt;&gt;&gt; list(s.items())</span>
<span class="sd">            [(&#39;field1&#39;, &#39;value&#39;), (&#39;field2&#39;, 42)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__struct_fields__</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">UNSET</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></div>


<div class="viewcode-block" id="LazyDictStruct.values">
<a class="viewcode-back" href="../../index.html#dictstruct.LazyDictStruct.values">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over the struct&#39;s field values.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; class MyStruct(DictStruct):</span>
<span class="sd">            ...     field1: str</span>
<span class="sd">            ...     field2: int</span>
<span class="sd">            &gt;&gt;&gt; s = MyStruct(field1=&quot;value&quot;, field2=42)</span>
<span class="sd">            &gt;&gt;&gt; list(s.values())</span>
<span class="sd">            [&#39;value&#39;, 42]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__struct_fields__</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">UNSET</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSET</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">value</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, BobTheBuidler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>